---
layout: post
title: "Introduction à Opal.rb"
date: 2014-06-06 19:56
comments: true
categories: [débutant, opal.rb, ruby, javascript]
---

{% level 1 %}

Ça faisait un certain temps que je voulais essayer
[Opal.rb](http://opalrb.org/), un compilateur Ruby vers Javascript.

C'est fait ! Voici donc un *Hello world!* avec Opal.rb.

<!-- more -->

Tout d'abord, on installe la gem:

    gem install opal

Ensuite, on se fait un fichier `hello.rb` avec le contenu suivant:

``` ruby hello.rb
puts 'Hello world!'
```

Bon jusque là, c'est simple ;) Maintenant on arrive au passage que j'aime le
moins. Je n'ai pas trouvé de commande pour compiler un fichier Ruby. Il
faut se l'écrire soi-même, bizarre. En voici un possible:

``` ruby rb2js.rb
require 'opal'

puts Opal.compile(IO.read(ARGV[0]))
```

Voici ce que ça donne:

    $ ruby rb2js.rb hello.rb
    /* Generated by Opal 0.6.2 */
    (function($opal) {
      var self = $opal.top, $scope = $opal, nil = $opal.nil, $breaker = $opal.breaker, $slice = $opal.slice;

      $opal.add_stubs(['$puts']);
      return self.$puts("Hello world!")
    })(Opal);

On va s'enregistrer ça dans un fichier `hello.js`:

    $ ruby rb2js.rb hello.rb > hello.js

Reste à se faire un fichier HTML pour voir ce que ça donne:

``` html index.html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="lib/opal.min.js"></script>
    <script src="lib/opal-parser.min.js"></script>
  </head>
  <body>
    <script src="hello.js"></script>
  </body>
</html>
```

On peut ouvrir `index.html` avec `see index.html` si on est sous Linux, ou
bien `open index.html` si on est sous OS X. Et enfin, **dans la console**, on
peut voir notre *Hello world!*.

<script id='fb33k8u'>(function(i){var f,s=document.getElementById(i);f=document.createElement('iframe');f.src='//api.flattr.com/button/view/?uid=lkdjiin&url='+encodeURIComponent(document.URL);f.title='Flattr';f.height=62;f.width=55;f.style.borderWidth=0;s.parentNode.insertBefore(f,s);})('fb33k8u');</script>

À demain.

{% connexe %}
