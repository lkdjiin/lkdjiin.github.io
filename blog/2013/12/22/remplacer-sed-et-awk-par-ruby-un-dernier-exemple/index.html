
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Remplacer Sed et Awk par Ruby: Un dernier exemple - Xavier Nayrac</title>
  <meta name="author" content="Xavier Nayrac">

  
  <meta name="description" content="Niveau : facile Avant de mettre un terme à cette série d’articles, j’aimerais donner
un dernier exemple concret de l’utilisation de Ruby en mode Sed/ &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lkdjiin.github.io/blog/2013/12/22/remplacer-sed-et-awk-par-ruby-un-dernier-exemple">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Xavier Nayrac" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39286891-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><a href="/">
  <img src="http://www.gravatar.com/avatar/f6d0dff2dbb2fdc08fb1318116ea572c?s=140"/>
</a>
<h1><a href="/">Xavier Nayrac</a></h1>
<h2>
  Rubyiste accro au TDD, serial blogger, apprenti data scientist, heureux utilisateur de Vim,
  accordéoniste.<br/>
  Si vous vous sentez particulièrement généreux,
  <a href="https://twitter.com/lkdjiin">suivez moi sur Twitter</a>.
</h2>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><img src="/images/rss.png"></img>
    RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="lkdjiin.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Chercher"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Remplacer Sed et Awk par Ruby: Un dernier exemple</h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-12-22T20:58:00+01:00" pubdate data-updated="true">22 décembre 2013</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><div class="level-tag level-tag-1">Niveau : <span>facile</span></div>

<p>Avant de mettre un terme à cette série d’articles, j’aimerais donner
un dernier exemple concret de l’utilisation de Ruby en <em>mode</em> Sed/Awk.
Il y a quelques jours, j’ai ajouté un bouton «flattr» à la fin des
quelques 160 articles de ce blog. Voici comment j’ai fait…</p>

<!-- more -->

<p>Tout d’abord le script Ruby:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>script.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">BEGIN</span><span class="p">{</span><span class="n">code</span><span class="o">=</span> <span class="s2">&quot;code à insérer&quot;</span><span class="p">}</span>
</span><span class="line">
</span><span class="line"><span class="k">if</span> <span class="vg">$_</span><span class="o">.</span><span class="n">start_with?</span><span class="p">(</span><span class="s2">&quot;À demain.&quot;</span><span class="p">)</span>
</span><span class="line">  <span class="vg">$_</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="si">#{</span><span class="n">code</span><span class="si">}</span><span class="se">\n\n</span><span class="si">#{</span><span class="vg">$_</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Je cherche à insérer le code avant la chaîne “À demain.”, qui termine
chacun de mes articles. Si vous avez suivi cette série d’articles depuis
le début, j’espère que ce script parle de lui-même…
Notez quand même que ce script demande une version de Ruby supérieure
ou égale à 2.0, ou alors il faudra ajouter un commentaire <em>magique</em> pour
spécifier l’encodage utf-8.</p>

<p>Maintenant, comment appliquer ce script à chacun des articles. J’ai choisi
d’utiliser une boucle en Bash:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
</pre></td><td class="code"><pre><code class="bash"><span class="line"><span class="o">[</span>~<span class="o">]</span>⇒ <span class="k">for </span>i in *.markdown; <span class="k">do </span>ruby -p -i script.rb <span class="nv">$i</span>; <span class="k">done</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Si vous avez besoin d’explications sur cette ligne de commande, je vous
renvoie à ces articles:</p>

<ul>
  <li><a href="http://lkdjiin.github.io/blog/2013/12/04/remplacer-sed-et-awk-par-ruby-4-les-options-p-et-l/">ruby -p</a></li>
  <li><a href="http://lkdjiin.github.io/blog/2013/12/08/remplacer-sed-et-awk-par-ruby-7-modifier-slash-sauvegarder-les-donnees/">ruby -i</a></li>
  <li><a href="http://lkdjiin.github.io/blog/2013/08/23/bash-ajouter-une-ligne-a-la-fin-de-plusieurs-fichiers/">Les boucles en Bash</a></li>
</ul>

<script id="fb33k8u">(function(i){var f,s=document.getElementById(i);f=document.createElement('iframe');f.src='//api.flattr.com/button/view/?uid=lkdjiin&url='+encodeURIComponent(document.URL);f.title='Flattr';f.height=62;f.width=55;f.style.borderWidth=0;s.parentNode.insertBefore(f,s);})('fb33k8u');</script>

<p>À demain.</p>

<section><h1>Articles connexes</h1><ul><li><a href="/blog/2013/12/24/remplacer-sed-et-awk-par-ruby-recapitulatif/">Remplacer Sed et Awk par Ruby: Récapitulatif</a></li><li><a href="/blog/2013/12/21/remplacer-sed-et-awk-par-ruby-flip-flop/">Remplacer Sed et Awk par Ruby: Flip flop</a></li><li><a href="/blog/2013/12/18/remplacer-sed-et-awk-par-ruby-13-separateurs-en-sortie/">Remplacer Sed et Awk par Ruby 13: Séparateurs en sortie</a></li></ul></section>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posté par <span class="fn">Xavier Nayrac</span></span>

      








  


<time datetime="2013-12-22T20:58:00+01:00" pubdate data-updated="true">22 décembre 2013</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/awk/'>awk</a>, <a class='category' href='/blog/categories/bash/'>bash</a>, <a class='category' href='/blog/categories/debutant/'>débutant</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>, <a class='category' href='/blog/categories/sed/'>sed</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://lkdjiin.github.io/blog/2013/12/22/remplacer-sed-et-awk-par-ruby-un-dernier-exemple/" data-via="lkdjiin" data-counturl="http://lkdjiin.github.io/blog/2013/12/22/remplacer-sed-et-awk-par-ruby-un-dernier-exemple/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
  
    <div class="fb-like" data-send="true" data-width="450" data-show-faces="false"></div>
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2013/12/21/remplacer-sed-et-awk-par-ruby-flip-flop/" title="Previous Post: Remplacer Sed et Awk par Ruby: Flip flop">&laquo; Remplacer Sed et Awk par Ruby: Flip flop</a>
      
      
        <a class="basic-alignment right" href="/blog/2013/12/23/les-algorithmes-genetiques-demystifies-47-economie/" title="Next Post: Les algorithmes génétiques démystifiés 47: Économie">Les algorithmes génétiques démystifiés 47: Économie &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Commentaires</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Articles récents</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/07/29/coco-version-0-dot-13-dot-0/">Coco version 0.13.0</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/27/how-to-stay-productive-while-working-from-home/">How to stay productive while working from home</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/20/de-meilleurs-alias-avec-zsh/">De meilleurs alias avec zsh</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/13/comment-jai-ameliore-mon-ruby-avec-des-contrats/">Comment j'ai amélioré mon Ruby avec des contrats</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/07/11/extraction-des-tags-de-mon-blog-en-ligne-de-commande/">Extraction des tags de mon blog en ligne de commande</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Sur Twitter</h1>
  <a class="twitter-timeline"  href="https://twitter.com/lkdjiin" data-widget-id="554992534532136960">Tweets de @lkdjiin</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Xavier Nayrac -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'confessionsdeveloppeur';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://lkdjiin.github.io/blog/2013/12/22/remplacer-sed-et-awk-par-ruby-un-dernier-exemple/';
        var disqus_url = 'http://lkdjiin.github.io/blog/2013/12/22/remplacer-sed-et-awk-par-ruby-un-dernier-exemple/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['\\(','\\)']]}
});
</script>
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>


</body>
</html>
