
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Xavier Nayrac</title>
  <meta name="author" content="Xavier Nayrac">

  
  <meta name="description" content="Niveau : intermédiaire Je continue le refactoring de SORM. Voici la classe Database dans son
état actuel: sorm.rb1
2
3
4
5
6
7
8
9
10
11
12
13
14
15 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lkdjiin.github.io/blog/page/18">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Xavier Nayrac" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39286891-4']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><a href="/">
  <img src="http://www.gravatar.com/avatar/f6d0dff2dbb2fdc08fb1318116ea572c?s=140"/>
</a>
<h1><a href="/">Xavier Nayrac</a></h1>
<h2>
  Accro au TDD, rubyiste mais pas que, maker, heureux utilisateur de Vim,
  accordéoniste.<br/>
  Si vous vous sentez particulièrement généreux,
  <a href="https://twitter.com/lkdjiin">suivez moi sur Twitter</a>.
</h2>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><img src="/images/rss.png"></img>
    RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="lkdjiin.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Chercher"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/25/ruby-et-si-on-ecrivait-un-orm-partie-8/">Ruby - Et si on écrivait un ORM ? - partie 8</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-25T21:17:00+02:00" pubdate data-updated="true">25 avril 2014</time>
        
         | <a href="/blog/2014/04/25/ruby-et-si-on-ecrivait-un-orm-partie-8/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-2">Niveau : <span>intermédiaire</span></div>

<p>Je continue le refactoring de SORM. Voici la classe <code>Database</code> dans son
état actuel:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>sorm.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="nb">require</span> <span class="s1">&#39;sqlite3&#39;</span>
</span><span class="line">
</span><span class="line"><span class="k">module</span> <span class="nn">SORM</span>
</span><span class="line">
</span><span class="line">  <span class="k">class</span> <span class="nc">Database</span>
</span><span class="line">    <span class="vc">@@db</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">connect</span><span class="p">(</span><span class="n">database_filename</span><span class="p">)</span>
</span><span class="line">      <span class="vc">@@db</span> <span class="o">=</span> <span class="ss">SQLite3</span><span class="p">:</span><span class="ss">:Database</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">database_filename</span><span class="p">)</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">connected?</span>
</span><span class="line">      <span class="vc">@@db</span> <span class="p">?</span> <span class="kp">true</span> <span class="p">:</span> <span class="kp">false</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">
</span><span class="line">    <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">connection</span>
</span><span class="line">      <span class="vc">@@db</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="c1"># ...</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/25/ruby-et-si-on-ecrivait-un-orm-partie-8/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/24/ruby-et-si-on-ecrivait-un-orm-partie-7/">Ruby - Et si on écrivait un ORM ? - partie 7</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-24T21:01:00+02:00" pubdate data-updated="true">24 avril 2014</time>
        
         | <a href="/blog/2014/04/24/ruby-et-si-on-ecrivait-un-orm-partie-7/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-2">Niveau : <span>intermédiaire</span></div>

<p>Seconde partie du refactoring de SORM, mon <em>toy ORM</em> qui me sert de
prétexte pour quelques articles ;)</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/24/ruby-et-si-on-ecrivait-un-orm-partie-7/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/23/le-double-bang-en-ruby/">Le double bang en Ruby</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-23T20:59:00+02:00" pubdate data-updated="true">23 avril 2014</time>
        
         | <a href="/blog/2014/04/23/le-double-bang-en-ruby/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-1">Niveau : <span>facile</span></div>

<h2 id="ou-encore--ou-double-point-dexclamation">Ou encore !!, ou double point d’exclamation</h2>

<p>On peut voir ici ou là ce genre de code Ruby:</p>

<pre><code>!!expression
</code></pre>

<p><em>-C’est un truc qui n’est d’ailleurs pas spécifique au langage Ruby-</em>
Pourquoi voudrait-on écrire ça ?</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/23/le-double-bang-en-ruby/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/22/demandez-conseil-regulierement/">Demandez conseil régulièrement</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-22T21:43:00+02:00" pubdate data-updated="true">22 avril 2014</time>
        
         | <a href="/blog/2014/04/22/demandez-conseil-regulierement/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-1">Niveau : <span>facile</span></div>

<p>Aujourd’hui je réparais un bug, rien de très compliqué, juste un
évènement qui n’était pas appelé. Et j’en ai profité pour faire un
refactoring: passer d’une grosse méthode de classe à quelque chose de
plus construit.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/22/demandez-conseil-regulierement/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/21/rails-4-dot-1-avec-spring-rspec-ou-minitest-et-coco/">Rails 4.1 avec Spring, Rspec ou Minitest et Coco</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-21T21:15:00+02:00" pubdate data-updated="true">21 avril 2014</time>
        
         | <a href="/blog/2014/04/21/rails-4-dot-1-avec-spring-rspec-ou-minitest-et-coco/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-1">Niveau : <span>facile</span></div>

<p>Rails 4.1 est sorti récemment. Une des nouveautés est qu’il est livré avec
<a href="https://github.com/rails/spring">Spring</a>, qui permet d’accélerer le
développement en gardant, en quelque sorte, l’application rails en mémoire.
Voici, très rapidement, comment configurer Rails 4.1 avec soit Rspec, soit
Minitest comme framework de test, et <a href="https://github.com/lkdjiin/coco">Coco</a> comme outil de <em>code coverage</em>.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/21/rails-4-dot-1-avec-spring-rspec-ou-minitest-et-coco/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/20/ruby-et-si-on-ecrivait-un-orm-partie-6/">Ruby - Et si on écrivait un ORM ? - partie 6</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-20T12:53:00+02:00" pubdate data-updated="true">20 avril 2014</time>
        
         | <a href="/blog/2014/04/20/ruby-et-si-on-ecrivait-un-orm-partie-6/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-2">Niveau : <span>intermédiaire</span></div>

<p>Hier je m’étais arrêté sur cette implémentation de <code>SORM.save</code>:</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line">  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">save</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</span><span class="line">    <span class="n">table</span> <span class="o">=</span> <span class="nb">self</span><span class="o">.</span><span class="n">to_s</span><span class="o">.</span><span class="n">downcase</span>
</span><span class="line">    <span class="n">columns</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">keys</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span class="line">    <span class="n">values</span> <span class="o">=</span> <span class="n">parameters</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">item</span><span class="o">|</span>
</span><span class="line">      <span class="n">item</span><span class="o">.</span><span class="n">class</span> <span class="o">==</span> <span class="nb">String</span> <span class="p">?</span> <span class="s2">&quot;&#39;</span><span class="si">#{</span><span class="n">item</span><span class="si">}</span><span class="s2">&#39;&quot;</span> <span class="p">:</span> <span class="n">item</span>
</span><span class="line">    <span class="k">end</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
</span><span class="line">    <span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;INSERT INTO </span><span class="si">#{</span><span class="n">table</span><span class="si">}</span><span class="s2"> (</span><span class="si">#{</span><span class="n">columns</span><span class="si">}</span><span class="s2">) VALUES(</span><span class="si">#{</span><span class="n">values</span><span class="si">}</span><span class="s2">);&quot;</span>
</span><span class="line">    <span class="vc">@@db</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Cette méthode est déja bien trop longue selon mes critères, et si on ne fait
pas quelque chose tout de suite on va vite se retrouver avec un tas de
méthodes de classe impossibles à remanier.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/20/ruby-et-si-on-ecrivait-un-orm-partie-6/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/19/ruby-et-si-on-ecrivait-un-orm-partie-5/">Ruby - Et si on écrivait un ORM ? - partie 5</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-19T21:14:00+02:00" pubdate data-updated="true">19 avril 2014</time>
        
         | <a href="/blog/2014/04/19/ruby-et-si-on-ecrivait-un-orm-partie-5/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-2">Niveau : <span>intermédiaire</span></div>

<p>Au menu d’aujourd’hui: réparation du test défecteux et début de la
création/insertion d’un objet.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/19/ruby-et-si-on-ecrivait-un-orm-partie-5/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/18/ruby-et-si-on-ecrivait-un-orm-partie-4/">Ruby - Et si on écrivait un ORM ? - partie 4</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-18T21:01:00+02:00" pubdate data-updated="true">18 avril 2014</time>
        
         | <a href="/blog/2014/04/18/ruby-et-si-on-ecrivait-un-orm-partie-4/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-2">Niveau : <span>intermédiaire</span></div>

<p>Maintenant qu’on peut se connecter à une base sqlite, je pense qu’il faut
qu’on puisse écrire des requêtes en pur SQL à partir d’un objet qui
hérite de SORM.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/18/ruby-et-si-on-ecrivait-un-orm-partie-4/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/17/mapper-la-souris-dans-vim-pour-quel-usage/">Mapper la souris dans Vim : pour quel usage ?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-17T21:10:00+02:00" pubdate data-updated="true">17 avril 2014</time>
        
         | <a href="/blog/2014/04/17/mapper-la-souris-dans-vim-pour-quel-usage/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-2">Niveau : <span>intermédiaire</span></div>

<p>Suite à <a href="https://twitter.com/VimLinks/status/456746951283720192">un tweet de @VimLinks</a>
j’ai (re)découvert aujourd’hui qu’on pouvait très bien mapper la souris dans
Vim.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/17/mapper-la-souris-dans-vim-pour-quel-usage/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/16/ruby-et-si-on-ecrivait-un-orm-partie-3/">Ruby - Et si on écrivait un ORM ? - partie 3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-16T21:23:00+02:00" pubdate data-updated="true">16 avril 2014</time>
        
         | <a href="/blog/2014/04/16/ruby-et-si-on-ecrivait-un-orm-partie-3/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><div class="level-tag level-tag-2">Niveau : <span>intermédiaire</span></div>

<p>Cette fois je me dis qu’il faudrait quand même se connecter à la base de
données avant d’aller plus loin…</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2014/04/16/ruby-et-si-on-ecrivait-un-orm-partie-3/">Lire l&#8217;article &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/19/">&larr; Plus anciens</a>
    
    <a href="/blog/archives">Archives du blog</a>
    
    <a class="next" href="/blog/page/17/">Plus récents &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Articles récents</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/01/20/retour-sur-le-mooc-programmer-en-c/">Retour sur le MOOC Programmer en C</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/20/retour-du-mooc-designer-dans-un-fablab/">Retour du MOOC Designer dans un fablab</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/13/changer-de-shell-de-bash-a-fish/">Changer de shell, de Bash à Fish</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/11/bug-de-la-version-graphique-de-vim-sur-debian-sid/">Bug de la version graphique de Vim sur Debian Sid</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/02/comment-ecrire-un-framework-de-test-pour-ruby/">Comment écrire un framework de test pour Ruby</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Sur Twitter</h1>
  <a class="twitter-timeline"  href="https://twitter.com/lkdjiin" data-widget-id="554992534532136960">Tweets de @lkdjiin</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
          
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Xavier Nayrac -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'confessionsdeveloppeur';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['\\(','\\)']]}
});
</script>
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>


</body>
</html>
