
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Le jeu de la vie en ruby (opal) - partie 2 - Xavier Nayrac</title>
  <meta name="author" content="Xavier Nayrac">

  
  <meta name="description" content="Niveau : intermédiaire Deuxième partie du jeu de la vie en Ruby/Opal.rb, on va calculer le prochain
état d’une cellule, et extraire un voisinage de &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lkdjiin.github.io/blog/2014/10/27/le-jeu-de-la-vie-en-ruby-opal-partie-2">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Xavier Nayrac" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


</head>

<body   >
  <header role="banner"><a href="/">
  <img src="http://www.gravatar.com/avatar/f6d0dff2dbb2fdc08fb1318116ea572c?s=140"/>
</a>
<h1><a href="/">Xavier Nayrac</a></h1>
<h2>
  Accro au TDD, rubyiste mais pas que, maker, heureux utilisateur de Vim.<br/>
  Si vous vous sentez particulièrement généreux,
  <a href="https://twitter.com/lkdjiin">suivez moi sur Twitter</a>.
</h2>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><img src="/images/rss.png"></img>
    RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="lkdjiin.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Chercher"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Le jeu de la vie en ruby (opal) - partie 2</h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-10-27T21:09:00+01:00" pubdate data-updated="true">27 octobre 2014</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><div class="level-tag level-tag-2">Niveau : <span>intermédiaire</span></div>

<p>Deuxième partie du jeu de la vie en Ruby/Opal.rb, on va calculer le prochain
état d’une cellule, et extraire un <em>voisinage</em> de cellules d’une génération.
Après l’avoir écrit en Javascript, j’avoue que cette partie est quelque peu
ennuyeuse à reproduire. Je vais montrer du code, mais il y aura peu
d’explications, la logique étant la même qu’en Javascript (quoiqu’à base de
classes cette fois-ci).</p>

<!-- more -->

<p>Premier test et première classe pour spécifier une API.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>spec/neighborhood_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="nb">require</span> <span class="s1">&#39;./app/neighborhood.rb&#39;</span>
</span><span class="line">
</span><span class="line"><span class="n">describe</span> <span class="no">Neighborhood</span> <span class="k">do</span>
</span><span class="line">
</span><span class="line">  <span class="n">let</span><span class="p">(</span><span class="ss">:alive</span><span class="p">)</span> <span class="p">{</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span> <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="n">describe</span> <span class="s1">&#39;#next_state&#39;</span> <span class="k">do</span>
</span><span class="line">
</span><span class="line">    <span class="n">it</span> <span class="s1">&#39;returns 1 when it will be alive&#39;</span> <span class="k">do</span>
</span><span class="line">      <span class="n">neighborhood</span> <span class="o">=</span> <span class="no">Neighborhood</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">alive</span><span class="p">)</span>
</span><span class="line">      <span class="n">expect</span><span class="p">(</span><span class="n">neighborhood</span><span class="o">.</span><span class="n">next_state</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">1</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">Neighborhood</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
</span><span class="line">    <span class="vi">@cells</span> <span class="o">=</span> <span class="n">cells</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">next_state</span>
</span><span class="line">    <span class="mi">1</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p><code>next_state</code> doit être capable de determiner que la cellule va mourrir.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>spec/neighborhood_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="nb">require</span> <span class="s1">&#39;./app/neighborhood.rb&#39;</span>
</span><span class="line">
</span><span class="line"><span class="n">describe</span> <span class="no">Neighborhood</span> <span class="k">do</span>
</span><span class="line">
</span><span class="line">  <span class="n">let</span><span class="p">(</span><span class="ss">:alive</span><span class="p">)</span>       <span class="p">{</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span> <span class="p">}</span>
</span><span class="line">  <span class="n">let</span><span class="p">(</span><span class="ss">:dead</span><span class="p">)</span>        <span class="p">{</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span> <span class="p">}</span>
</span><span class="line">  <span class="n">let</span><span class="p">(</span><span class="ss">:dead2</span><span class="p">)</span>       <span class="p">{</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span> <span class="p">}</span>
</span><span class="line">  <span class="n">let</span><span class="p">(</span><span class="ss">:dead3</span><span class="p">)</span>       <span class="p">{</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span> <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="n">describe</span> <span class="s1">&#39;#next_state&#39;</span> <span class="k">do</span>
</span><span class="line">
</span><span class="line">    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class="line">
</span><span class="line">    <span class="n">it</span> <span class="s1">&#39;returns 0 when it will be dead&#39;</span> <span class="k">do</span>
</span><span class="line">      <span class="o">[</span><span class="n">dead</span><span class="p">,</span> <span class="n">dead2</span><span class="p">,</span> <span class="n">dead3</span><span class="o">].</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">cells</span><span class="o">|</span>
</span><span class="line">        <span class="n">neighborhood</span> <span class="o">=</span> <span class="no">Neighborhood</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
</span><span class="line">        <span class="n">expect</span><span class="p">(</span><span class="n">neighborhood</span><span class="o">.</span><span class="n">next_state</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">0</span>
</span><span class="line">      <span class="k">end</span>
</span><span class="line">    <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">Neighborhood</span>
</span><span class="line">
</span><span class="line">  <span class="no">ALIVE</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
</span><span class="line">    <span class="vi">@sum</span> <span class="o">=</span> <span class="n">cells</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="ss">:+</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">next_state</span>
</span><span class="line">    <span class="vi">@sum</span> <span class="o">==</span> <span class="no">ALIVE</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="mi">0</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Quand le nombre de cellules vivantes du voisinage est 4, le prochain état de
la cellule est le même que l’état actuel.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>spec/neighborhood_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="nb">require</span> <span class="s1">&#39;./app/neighborhood.rb&#39;</span>
</span><span class="line">
</span><span class="line"><span class="n">describe</span> <span class="no">Neighborhood</span> <span class="k">do</span>
</span><span class="line">
</span><span class="line">  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class="line">
</span><span class="line">  <span class="n">let</span><span class="p">(</span><span class="ss">:status_quo1</span><span class="p">)</span> <span class="p">{</span> <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span> <span class="p">}</span>
</span><span class="line">  <span class="n">let</span><span class="p">(</span><span class="ss">:status_quo2</span><span class="p">)</span> <span class="p">{</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span> <span class="p">}</span>
</span><span class="line">
</span><span class="line">  <span class="n">describe</span> <span class="s1">&#39;#next_state&#39;</span> <span class="k">do</span>
</span><span class="line">
</span><span class="line">    <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class="line">
</span><span class="line">    <span class="n">it</span> <span class="s1">&#39;returns old state in other cases&#39;</span> <span class="k">do</span>
</span><span class="line">      <span class="n">neighborhood</span> <span class="o">=</span> <span class="no">Neighborhood</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">status_quo1</span><span class="p">)</span>
</span><span class="line">      <span class="n">expect</span><span class="p">(</span><span class="n">neighborhood</span><span class="o">.</span><span class="n">next_state</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">0</span>
</span><span class="line">
</span><span class="line">      <span class="n">neighborhood</span> <span class="o">=</span> <span class="no">Neighborhood</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">status_quo2</span><span class="p">)</span>
</span><span class="line">      <span class="n">expect</span><span class="p">(</span><span class="n">neighborhood</span><span class="o">.</span><span class="n">next_state</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">1</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">Neighborhood</span>
</span><span class="line">
</span><span class="line">  <span class="no">ALIVE</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class="line">  <span class="no">STATUS_QUO</span> <span class="o">=</span> <span class="mi">4</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>
</span><span class="line">    <span class="vi">@subject</span> <span class="o">=</span> <span class="n">cells</span><span class="o">[</span><span class="mi">4</span><span class="o">]</span>
</span><span class="line">    <span class="vi">@sum</span> <span class="o">=</span> <span class="n">cells</span><span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="ss">:+</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">next_state</span>
</span><span class="line">    <span class="k">case</span> <span class="vi">@sum</span>
</span><span class="line">    <span class="k">when</span> <span class="no">ALIVE</span> <span class="k">then</span> <span class="mi">1</span>
</span><span class="line">    <span class="k">when</span> <span class="no">STATUS_QUO</span> <span class="k">then</span> <span class="vi">@subject</span>
</span><span class="line">    <span class="k">else</span>
</span><span class="line">      <span class="mi">0</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="extraire-un-voisinage-de-cellules">Extraire un voisinage de cellules</h2>

<p>Il faut pouvoir extraire un ensemble de 9 cellules (le <em>voisinage</em>) d’une
génération.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>spec/neighborhood_extractor_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="nb">require</span> <span class="s1">&#39;./app/neighborhood_extractor.rb&#39;</span>
</span><span class="line">
</span><span class="line"><span class="n">describe</span> <span class="no">NeighborhoodExtractor</span> <span class="k">do</span>
</span><span class="line">
</span><span class="line">  <span class="n">let</span><span class="p">(</span><span class="ss">:generation</span><span class="p">)</span> <span class="k">do</span>
</span><span class="line">    <span class="o">[</span>
</span><span class="line">      <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span>
</span><span class="line">      <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class="line">      <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line">    <span class="o">]</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="n">it</span> <span class="s1">&#39;returns 9 cells&#39;</span> <span class="k">do</span>
</span><span class="line">    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
</span><span class="line">    <span class="n">extractor</span> <span class="o">=</span> <span class="no">NeighborhoodExtractor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">generation</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span class="line">    <span class="n">expect</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="n">cells</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="mi">9</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Ça, c’est juste la mise en train.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood_extractor.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">NeighborhoodExtractor</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">generation</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">cells</span>
</span><span class="line">    <span class="nb">Array</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Là, on commence à faire quelque chose d’utile.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>spec/neighborhood_extractor_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">describe</span> <span class="no">NeighborhoodExtractor</span> <span class="k">do</span>
</span><span class="line">
</span><span class="line">  <span class="n">let</span><span class="p">(</span><span class="ss">:generation</span><span class="p">)</span> <span class="k">do</span>
</span><span class="line">    <span class="o">[</span>
</span><span class="line">      <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span><span class="p">,</span>
</span><span class="line">      <span class="o">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span><span class="p">,</span>
</span><span class="line">      <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line">    <span class="o">]</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class="line">
</span><span class="line">  <span class="n">describe</span> <span class="s1">&#39;inner position&#39;</span> <span class="k">do</span>
</span><span class="line">    <span class="n">specify</span> <span class="s1">&#39;x=1 y=1&#39;</span> <span class="k">do</span>
</span><span class="line">      <span class="n">extractor</span> <span class="o">=</span> <span class="no">NeighborhoodExtractor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">generation</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line">      <span class="n">expect</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood_extractor.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">NeighborhoodExtractor</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:generation</span><span class="p">,</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">cells</span>
</span><span class="line">    <span class="o">[</span>
</span><span class="line">      <span class="o">*</span><span class="n">generation</span><span class="o">[</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span><span class="p">,</span>
</span><span class="line">      <span class="o">*</span><span class="n">generation</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span><span class="p">,</span>
</span><span class="line">      <span class="o">*</span><span class="n">generation</span><span class="o">[</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span><span class="p">,</span>
</span><span class="line">    <span class="o">]</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Maintenant, voyons le problème des bordures.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>spec/neighborhood_extractor_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line">  <span class="n">describe</span> <span class="s1">&#39;borders&#39;</span> <span class="k">do</span>
</span><span class="line">    <span class="n">specify</span> <span class="s1">&#39;x=1 y=0&#39;</span> <span class="k">do</span>
</span><span class="line">      <span class="n">extractor</span> <span class="o">=</span> <span class="no">NeighborhoodExtractor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">generation</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span class="line">      <span class="n">expect</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>La manière dont le test échoue est intéressante. C’est du à la façon dont Ruby
gère les indexs négatifs pour les tableaux, ceux-cis sont parfaitement
autorisés.</p>

<pre><code>Failures:

  1) NeighborhoodExtractor borders x=1 y=0
     Failure/Error: expect(extractor.cells).to eq [0, 0, 0, 0, 1, 0, 1, 0, 1]
       
       expected: [0, 0, 0, 0, 1, 0, 1, 0, 1]
            got: [0, 1, 1, 0, 1, 0, 1, 0, 1]
       
       (compared using ==)
     # ./spec/neighborhood_extractor_spec.rb:29:in `block (3 levels) in &lt;top (required)&gt;'
</code></pre>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood_extractor.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">NeighborhoodExtractor</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:generation</span><span class="p">,</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">cells</span>
</span><span class="line">    <span class="o">[</span>
</span><span class="line">      <span class="o">*</span><span class="n">row1</span><span class="p">,</span>
</span><span class="line">      <span class="o">*</span><span class="n">generation</span><span class="o">[</span><span class="n">y</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span><span class="p">,</span>
</span><span class="line">      <span class="o">*</span><span class="n">generation</span><span class="o">[</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span><span class="p">,</span>
</span><span class="line">    <span class="o">]</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">row1</span>
</span><span class="line">    <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class="line">      <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line">    <span class="k">else</span>
</span><span class="line">      <span class="n">generation</span><span class="o">[</span><span class="n">y</span><span class="o">-</span><span class="mi">1</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Testons avec la bordure du bas.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>spec/neighborhood_extractor_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">specify</span> <span class="s1">&#39;x=2 y=2&#39;</span> <span class="k">do</span>
</span><span class="line">  <span class="n">extractor</span> <span class="o">=</span> <span class="no">NeighborhoodExtractor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">generation</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</span><span class="line">  <span class="n">expect</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood_extractor.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">NeighborhoodExtractor</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:generation</span><span class="p">,</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">row3</span>
</span><span class="line">    <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="n">generation</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class="line">      <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line">    <span class="k">else</span>
</span><span class="line">      <span class="n">generation</span><span class="o">[</span><span class="n">y</span><span class="o">+</span><span class="mi">1</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Un peu de refactoring.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood_extractor.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">NeighborhoodExtractor</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:generation</span><span class="p">,</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">cells</span>
</span><span class="line">    <span class="o">[</span> <span class="o">*</span><span class="n">group_of_tree</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="o">*</span><span class="n">group_of_tree</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="o">*</span><span class="n">group_of_tree</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">]</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">group_of_tree</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">row</span> <span class="o">==</span> <span class="n">generation</span><span class="o">.</span><span class="n">size</span>
</span><span class="line">      <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line">    <span class="k">else</span>
</span><span class="line">      <span class="n">generation</span><span class="o">[</span><span class="n">row</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>La bordure de gauche.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>spec/neighborhood_extractor_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">specify</span> <span class="s1">&#39;x=0 y=1&#39;</span> <span class="k">do</span>
</span><span class="line">  <span class="n">extractor</span> <span class="o">=</span> <span class="no">NeighborhoodExtractor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">generation</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line">  <span class="n">expect</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="o">]</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood_extractor.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">NeighborhoodExtractor</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:generation</span><span class="p">,</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">cells</span>
</span><span class="line">    <span class="o">[</span> <span class="o">*</span><span class="n">group_of_tree</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="o">*</span><span class="n">group_of_tree</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="o">*</span><span class="n">group_of_tree</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">]</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">group_of_tree</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">row</span> <span class="o">==</span> <span class="n">generation</span><span class="o">.</span><span class="n">size</span>
</span><span class="line">      <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line">    <span class="k">else</span>
</span><span class="line">      <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class="line">        <span class="o">[</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">generation</span><span class="o">[</span><span class="n">row</span><span class="o">][</span><span class="n">x</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span> <span class="o">]</span>
</span><span class="line">      <span class="k">else</span>
</span><span class="line">        <span class="n">generation</span><span class="o">[</span><span class="n">row</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span>
</span><span class="line">      <span class="k">end</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Et enfin celle de droite.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>spec/neighborhood_extractor_spec.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">specify</span> <span class="s1">&#39;x=3 y=1&#39;</span> <span class="k">do</span>
</span><span class="line">  <span class="n">extractor</span> <span class="o">=</span> <span class="no">NeighborhoodExtractor</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">generation</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class="line">  <span class="n">expect</span><span class="p">(</span><span class="n">extractor</span><span class="o">.</span><span class="n">cells</span><span class="p">)</span><span class="o">.</span><span class="n">to</span> <span class="n">eq</span> <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Ok, c’est moche, mais ça fonctionne.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>app/neighborhood_extractor.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">NeighborhoodExtractor</span> <span class="o">&lt;</span> <span class="no">Struct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:generation</span><span class="p">,</span> <span class="ss">:x</span><span class="p">,</span> <span class="ss">:y</span><span class="p">)</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">cells</span>
</span><span class="line">    <span class="o">[</span> <span class="o">*</span><span class="n">group_of_tree</span><span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="o">*</span><span class="n">group_of_tree</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="o">*</span><span class="n">group_of_tree</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">]</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">group_of_tree</span><span class="p">(</span><span class="n">row_index</span><span class="p">)</span>
</span><span class="line">    <span class="k">if</span> <span class="n">row_index</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">||</span> <span class="n">row_index</span> <span class="o">==</span> <span class="n">generation</span><span class="o">.</span><span class="n">size</span>
</span><span class="line">      <span class="o">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line">    <span class="k">else</span>
</span><span class="line">      <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span>
</span><span class="line">        <span class="o">[</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">generation</span><span class="o">[</span><span class="n">row_index</span><span class="o">][</span><span class="n">x</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span> <span class="o">]</span>
</span><span class="line">      <span class="k">elsif</span> <span class="n">x</span> <span class="o">==</span> <span class="n">generation</span><span class="o">.</span><span class="n">first</span><span class="o">.</span><span class="n">size</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class="line">        <span class="o">[*</span><span class="n">generation</span><span class="o">[</span><span class="n">row_index</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">]</span><span class="p">,</span> <span class="mi">0</span><span class="o">]</span>
</span><span class="line">      <span class="k">else</span>
</span><span class="line">        <span class="n">generation</span><span class="o">[</span><span class="n">row_index</span><span class="o">][</span><span class="n">x</span><span class="o">-</span><span class="mi">1</span><span class="o">.</span><span class="n">.x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span>
</span><span class="line">      <span class="k">end</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Je devrais <em>refactorer</em> ce code, mais comme je sais qu’il va bientôt changer
(quand on va supprimer les bordures de la surface de jeu) je me dis qu’on verra
bien à ce moment là.</p>

<p>À noter pour finir que je ne teste pas les cas des cellules de coin. Nous avons
vu dans la version Javascript que si les cellules des bords droits, gauches,
hauts et bas fonctionnent, alors les coins fonctionnent aussi.</p>

<p>La prochaine fois on verra la classe <code>Game</code> et une petite astuce pour faire
un <code>sleep</code> like en Opal.rb.</p>

<script id="fb33k8u">(function(i){var f,s=document.getElementById(i);f=document.createElement('iframe');f.src='//api.flattr.com/button/view/?uid=lkdjiin&url='+encodeURIComponent(document.URL);f.title='Flattr';f.height=62;f.width=55;f.style.borderWidth=0;s.parentNode.insertBefore(f,s);})('fb33k8u');</script>

<section><h1>Articles connexes</h1><ul><li><a href="/blog/2014/10/29/le-jeu-de-la-vie-en-ruby-opal-partie-3/">Le jeu de la vie en ruby (opal) - partie 3</a></li><li><a href="/blog/2014/10/25/le-jeu-de-la-vie-en-ruby-opal-partie-1/">Le jeu de la vie en ruby (opal) - partie 1</a></li><li><a href="/blog/2014/10/08/le-jeu-de-la-vie-dans-sept-langages-differents/">Le jeu de la vie dans sept langages différents</a></li></ul></section>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posté par <span class="fn">Xavier Nayrac</span></span>

      








  


<time datetime="2014-10-27T21:09:00+01:00" pubdate data-updated="true">27 octobre 2014</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/jeu-de-la-vie/'>jeu de la vie</a>, <a class='category' href='/blog/categories/opal/'>opal</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2014/10/25/le-jeu-de-la-vie-en-ruby-opal-partie-1/" title="Previous Post: Le jeu de la vie en ruby (opal) - partie 1">&laquo; Le jeu de la vie en ruby (opal) - partie 1</a>
      
      
        <a class="basic-alignment right" href="/blog/2014/10/29/le-jeu-de-la-vie-en-ruby-opal-partie-3/" title="Next Post: Le jeu de la vie en ruby (opal) - partie 3">Le jeu de la vie en ruby (opal) - partie 3 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Commentaires</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Articles récents</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2018/08/30/heroku-ovh-les-naked-domains-et-les-dns/">Heroku, OVH, les naked domains, et les DNS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/21/comment-creer-votre-propre-localisation-sous-linux/">Comment créer votre propre localisation sous Linux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/07/27/gopher-recuperer-le-menu-principal/">Gopher : Récupérer le menu principal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/07/21/presentation-de-gopher/">Présentation de Gopher</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/14/lister-un-dossier-tout-en-nettoyant-lecran/">Lister un dossier tout en nettoyant l'écran</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/02/28/fish-completion-puis-execution-en-une-seule-fois/">Fish : complétion puis exécution en une seule fois</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/02/26/clojure-tests-et-couleurs/">Clojure, tests et couleurs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/25/oui-la-documentation-est-utile/">Oui la documentation est utile</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/20/retour-sur-le-mooc-programmer-en-c/">Retour sur le MOOC Programmer en C</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/20/retour-du-mooc-designer-dans-un-fablab/">Retour du MOOC Designer dans un fablab</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/13/changer-de-shell-de-bash-a-fish/">Changer de shell, de Bash à Fish</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/11/bug-de-la-version-graphique-de-vim-sur-debian-sid/">Bug de la version graphique de Vim sur Debian Sid</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/02/comment-ecrire-un-framework-de-test-pour-ruby/">Comment écrire un framework de test pour Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/04/comment-mettre-a-jour-un-package-r/">Comment mettre à jour un package R</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/02/12-points-pour-rater-la-conception-dun-mooc/">12 points pour rater la conception d'un MOOC</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/08/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-8/">Écrire un jeu en 2d avec Ruby et Gosu - partie 8</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/01/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-7/">Écrire un jeu en 2d avec Ruby et Gosu - partie 7</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/25/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-6/">Écrire un jeu en 2d avec Ruby et Gosu - partie 6</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/15/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-5/">Écrire un jeu en 2d avec Ruby et Gosu - partie 5</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/02/13/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-4/">Écrire un jeu en 2d avec Ruby et Gosu - partie 4</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Xavier Nayrac -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'confessionsdeveloppeur';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://lkdjiin.github.io/blog/2014/10/27/le-jeu-de-la-vie-en-ruby-opal-partie-2/';
        var disqus_url = 'http://lkdjiin.github.io/blog/2014/10/27/le-jeu-de-la-vie-en-ruby-opal-partie-2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['\\(','\\)']]}
});
</script>
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>


</body>
</html>
