
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Écrire un jeu en 2d avec Ruby et Gosu - partie 7 - Xavier Nayrac</title>
  <meta name="author" content="Xavier Nayrac">

  
  <meta name="description" content="Ça fait plus de 2 mois que je dois terminer ce jeu et cette série d’article, alors au boulot ! Pour cette nouvelle version je voudrais ajouter une &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://lkdjiin.github.io/blog/2016/05/01/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Xavier Nayrac" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">


</head>

<body   >
  <header role="banner"><a href="/">
  <img src="http://www.gravatar.com/avatar/f6d0dff2dbb2fdc08fb1318116ea572c?s=140"/>
</a>
<h1><a href="/">Xavier Nayrac</a></h1>
<h2>
  Accro au TDD, rubyiste mais pas que, maker, heureux utilisateur de Vim.<br/>
  Si vous vous sentez particulièrement généreux,
  <a href="https://twitter.com/lkdjiin">suivez moi sur Twitter</a>.
</h2>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS"><img src="/images/rss.png"></img>
    RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="lkdjiin.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Chercher"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Écrire un jeu en 2d avec Ruby et Gosu - partie 7</h1>
    
    
      <p class="meta">
        








  


<time datetime="2016-05-01T09:29:00+02:00" pubdate data-updated="true">1<span>er</span> mai 2016</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>Ça fait plus de 2 mois que je dois terminer ce jeu et cette série d’article, alors au boulot !</p>

<p>Pour cette nouvelle version je voudrais ajouter une musique différente pour le
game over.  Et aussi pouvoir enfin recommencer une nouvelle partie après
un <em>game over</em>.</p>

<p><img class="center" src="/images/gosu8.png" /></p>

<!-- more -->

<p>La totalité des articles:</p>

<ol>
  <li><a href="/blog/2016/02/10/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-1/">Installation de Gosu, affichage d’images statiques</a></li>
  <li><a href="/blog/2016/02/11/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-2/">Déplacer le joueur et pluie de smileys</a></li>
  <li><a href="/blog/2016/02/12/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-3/">Beep, fonte et collecte des smileys</a></li>
  <li><a href="/blog/2016/02/13/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-4/">On s’occupe des vies</a></li>
  <li><a href="/blog/2016/02/15/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-5/">Musique et game over</a></li>
  <li><a href="/blog/2016/02/25/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-6/">Affichage selon un angle</a></li>
  <li>Plusieurs musiques et reset de la partie</li>
</ol>

<h2 id="plusieurs-musiques">Plusieurs musiques</h2>

<p>Nous allons devoir gérer plusieurs musiques. Donnons leur des noms plus simple
à manipuler que leurs <em>paths</em> :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>song.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">module</span> <span class="nn">Song</span>
</span><span class="line">  <span class="no">GameOver</span> <span class="o">=</span> <span class="s2">&quot;assets/songs/In early time.ogg&quot;</span>
</span><span class="line">  <span class="no">Level1</span>   <span class="o">=</span> <span class="s2">&quot;assets/songs/Around the Bend.ogg&quot;</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Et avec quoi écoute-t-on de la musique ? Avec un <em>song player</em> :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>song_player.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">SongPlayer</span>
</span><span class="line">  <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span class="line">    <span class="vi">@song</span><span class="o">.</span><span class="n">stop</span> <span class="k">if</span> <span class="vi">@song</span>
</span><span class="line">    <span class="vi">@song</span> <span class="o">=</span> <span class="ss">Gosu</span><span class="p">:</span><span class="ss">:Song</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span class="line">    <span class="vi">@song</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">25</span>
</span><span class="line">    <span class="vi">@song</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Dans la classe <code>Window</code> on remplace l’ancienne manière de jouer une musique :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="vi">@song</span> <span class="o">=</span> <span class="ss">Gosu</span><span class="p">:</span><span class="ss">:Song</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;assets/songs/Around the Bend.ogg&quot;</span><span class="p">)</span>
</span><span class="line"><span class="vi">@song</span><span class="o">.</span><span class="n">volume</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">25</span>
</span><span class="line"><span class="vi">@song</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="kp">true</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>par notre nouvelle abstraction :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="vi">@song_player</span> <span class="o">=</span> <span class="no">SongPlayer</span><span class="o">.</span><span class="n">new</span>
</span><span class="line"><span class="vi">@song_player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="ss">Song</span><span class="p">:</span><span class="ss">:Level1</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>N’oubliez pas d’ajouter les require qui vont bien dans le fichier <code>main.rb</code> :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>main.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="n">require_relative</span> <span class="s1">&#39;song&#39;</span>
</span><span class="line"><span class="n">require_relative</span> <span class="s1">&#39;song_player&#39;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Trouver un bon endroit où mettre le code pour changer la musique après un
<em>game over</em> n’est pas si 
évident que ça. Le moment où l’on capte que le jeu est dans l’état game over est
la méthode <code>update_player</code> :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">update_player</span>
</span><span class="line">  <span class="vi">@player</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="vi">@items</span><span class="p">)</span>
</span><span class="line">  <span class="vi">@game_over</span> <span class="o">=</span> <span class="kp">true</span> <span class="k">if</span> <span class="vi">@player</span><span class="o">.</span><span class="n">lives</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Et il semblerait vraiment bizarre de modifier la musique alors qu’on est
sensé mettre à jour le joueur. Autrement dit, le code suivant ne me plait pas :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">update_player</span>
</span><span class="line">  <span class="vi">@player</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="vi">@items</span><span class="p">)</span>
</span><span class="line">  <span class="k">if</span> <span class="vi">@player</span><span class="o">.</span><span class="n">lives</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span class="line">    <span class="vi">@game_over</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class="line">    <span class="vi">@song_player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="ss">Song</span><span class="p">:</span><span class="ss">:GameOver</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>À bien y réfléchir, le problème vient d’avant. On ne devrait pas changer l’état
de <code>@game_over</code> ici, mais plutôt dans la méthode <code>update</code> :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>window.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">Window</span> <span class="o">&lt;</span> <span class="ss">Gosu</span><span class="p">:</span><span class="ss">:Window</span>
</span><span class="line">  <span class="k">def</span> <span class="nf">update</span>
</span><span class="line">    <span class="k">return</span> <span class="k">if</span> <span class="vi">@game_over</span>
</span><span class="line">
</span><span class="line">    <span class="vi">@game_over</span> <span class="o">=</span> <span class="kp">true</span> <span class="k">if</span> <span class="vi">@player</span><span class="o">.</span><span class="n">lives</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span class="line">    <span class="n">update_items</span>
</span><span class="line">    <span class="n">update_player</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">update_player</span>
</span><span class="line">    <span class="vi">@player</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="vi">@items</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Changer la musique se fera donc de cette manière :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">update</span>
</span><span class="line">  <span class="k">return</span> <span class="k">if</span> <span class="vi">@game_over</span>
</span><span class="line">
</span><span class="line">  <span class="k">if</span> <span class="vi">@player</span><span class="o">.</span><span class="n">lives</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span class="line">    <span class="vi">@game_over</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class="line">    <span class="vi">@song_player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="ss">Song</span><span class="p">:</span><span class="ss">:GameOver</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="n">update_items</span>
</span><span class="line">  <span class="n">update_player</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Après extraction d’une nouvelle méthode, nous obtenons un code plus clair :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">update</span>
</span><span class="line">  <span class="k">return</span> <span class="k">if</span> <span class="vi">@game_over</span>
</span><span class="line">
</span><span class="line">  <span class="n">update_game_over</span>
</span><span class="line">  <span class="n">update_items</span>
</span><span class="line">  <span class="n">update_player</span>
</span><span class="line"><span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">update_game_over</span>
</span><span class="line">  <span class="k">return</span> <span class="k">unless</span> <span class="vi">@player</span><span class="o">.</span><span class="n">lives</span> <span class="o">&lt;=</span> <span class="mi">0</span>
</span><span class="line">
</span><span class="line">  <span class="vi">@game_over</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class="line">  <span class="vi">@song_player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="ss">Song</span><span class="p">:</span><span class="ss">:GameOver</span><span class="p">)</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<h2 id="nouvelle-partie">Nouvelle partie</h2>

<p>Ok, il est temps maintenant de pouvoir jouer une nouvelle partie après un
game over. Pour cela, il faut regarder si le joueur appuie sur la touche
espace pendant l’état game over, et dans ce cas faire un reset :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">update</span>
</span><span class="line">  <span class="n">reset</span> <span class="k">if</span> <span class="vi">@game_over</span> <span class="o">&amp;&amp;</span> <span class="no">Button</span><span class="o">.</span><span class="n">space?</span>
</span><span class="line">
</span><span class="line">  <span class="k">return</span> <span class="k">if</span> <span class="vi">@game_over</span>
</span><span class="line">
</span><span class="line">  <span class="n">update_game_over</span>
</span><span class="line">  <span class="n">update_items</span>
</span><span class="line">  <span class="n">update_player</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>On peut tout de suite extraire une méthode <code>new_game?</code> :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">def</span> <span class="nf">update</span>
</span><span class="line">  <span class="n">reset</span> <span class="k">if</span> <span class="n">new_game?</span>
</span><span class="line">  <span class="c1"># [...]</span>
</span><span class="line"><span class="k">end</span>
</span><span class="line">
</span><span class="line"><span class="k">def</span> <span class="nf">new_game?</span>
</span><span class="line">  <span class="vi">@game_over</span> <span class="o">&amp;&amp;</span> <span class="no">Button</span><span class="o">.</span><span class="n">space?</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>On peut maintenant réfléchir à la méthode <code>reset</code>, qui a son tour appellera
la méthode <code>reset</code> du joueur. Ces deux méthodes sont évidentes :</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>window.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">Window</span> <span class="o">&lt;</span> <span class="ss">Gosu</span><span class="p">:</span><span class="ss">:Window</span>
</span><span class="line">  <span class="k">def</span> <span class="nf">reset</span>
</span><span class="line">    <span class="vi">@items</span> <span class="o">=</span> <span class="o">[]</span>
</span><span class="line">    <span class="vi">@player</span><span class="o">.</span><span class="n">reset</span>
</span><span class="line">    <span class="vi">@song_player</span><span class="o">.</span><span class="n">play</span><span class="p">(</span><span class="ss">Song</span><span class="p">:</span><span class="ss">:Level1</span><span class="p">)</span>
</span><span class="line">    <span class="vi">@game_over</span> <span class="o">=</span> <span class="kp">false</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span>player.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">Player</span>
</span><span class="line">  <span class="k">def</span> <span class="nf">reset</span>
</span><span class="line">    <span class="vi">@score</span> <span class="o">=</span> <span class="mi">0</span>
</span><span class="line">    <span class="vi">@lives</span> <span class="o">=</span> <span class="mi">3</span>
</span><span class="line">    <span class="vi">@angle</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span>
</span><span class="line">    <span class="vi">@velocity</span> <span class="o">=</span> <span class="mi">0</span><span class="o">.</span><span class="mi">0</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Pour terminer cette version, on va ajouter un message «press space to start»
qui bouge pour attirer l’attention. Pour ça, on varie régulièrement d’une
petite quantité la coordonnée <strong>y</strong> du message.</p>

<div class="bogus-wrapper"><notextile><figure class="code"><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class="line-number">1</span>
<span class="line-number">2</span>
<span class="line-number">3</span>
<span class="line-number">4</span>
<span class="line-number">5</span>
<span class="line-number">6</span>
<span class="line-number">7</span>
<span class="line-number">8</span>
<span class="line-number">9</span>
<span class="line-number">10</span>
<span class="line-number">11</span>
<span class="line-number">12</span>
<span class="line-number">13</span>
<span class="line-number">14</span>
<span class="line-number">15</span>
<span class="line-number">16</span>
<span class="line-number">17</span>
<span class="line-number">18</span>
<span class="line-number">19</span>
<span class="line-number">20</span>
<span class="line-number">21</span>
<span class="line-number">22</span>
<span class="line-number">23</span>
<span class="line-number">24</span>
<span class="line-number">25</span>
<span class="line-number">26</span>
<span class="line-number">27</span>
<span class="line-number">28</span>
<span class="line-number">29</span>
<span class="line-number">30</span>
<span class="line-number">31</span>
</pre></td><td class="code"><pre><code class="ruby"><span class="line"><span class="k">class</span> <span class="nc">UI</span>
</span><span class="line">  <span class="c1"># ...</span>
</span><span class="line">  <span class="no">PressSpaceLow</span> <span class="o">=</span> <span class="mi">210</span>
</span><span class="line">  <span class="no">PressSpaceHigh</span> <span class="o">=</span> <span class="mi">270</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">initialize</span>
</span><span class="line">    <span class="c1"># ...</span>
</span><span class="line">    <span class="vi">@y</span> <span class="o">=</span> <span class="mi">240</span>
</span><span class="line">    <span class="vi">@y_velocity</span> <span class="o">=</span> <span class="o">-</span><span class="mi">0</span><span class="o">.</span><span class="mi">3</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="kp">private</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">draw_game_over</span>
</span><span class="line">    <span class="vi">@big_font</span><span class="o">.</span><span class="n">draw_rel</span><span class="p">(</span><span class="s2">&quot;Game Over&quot;</span><span class="p">,</span> <span class="no">WindowWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="no">WindowHeight</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span>
</span><span class="line">                       <span class="ss">ZOrder</span><span class="p">:</span><span class="ss">:UI</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
</span><span class="line">    <span class="vi">@big_font</span><span class="o">.</span><span class="n">draw_rel</span><span class="p">(</span><span class="s2">&quot;Press Space To Start&quot;</span><span class="p">,</span> <span class="no">WindowWidth</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span>
</span><span class="line">                       <span class="ss">ZOrder</span><span class="p">:</span><span class="ss">:UI</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="o">.</span><span class="mi">5</span><span class="p">)</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">y</span>
</span><span class="line">    <span class="vi">@y</span> <span class="o">+=</span> <span class="n">y_velocity</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line">
</span><span class="line">  <span class="k">def</span> <span class="nf">y_velocity</span>
</span><span class="line">    <span class="k">if</span> <span class="vi">@y</span> <span class="o">&lt;</span> <span class="no">PressSpaceLow</span> <span class="o">||</span> <span class="vi">@y</span> <span class="o">&gt;</span> <span class="no">PressSpaceHigh</span>
</span><span class="line">      <span class="vi">@y_velocity</span> <span class="o">=</span> <span class="o">-</span><span class="vi">@y_velocity</span>
</span><span class="line">    <span class="k">end</span>
</span><span class="line">    <span class="vi">@y_velocity</span>
</span><span class="line">  <span class="k">end</span>
</span><span class="line"><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<p>Pour finir, voici le contenu du jeu pour l’instant:</p>

<pre><code>$ tree
.
├── assets
│   ├── fonts
│   │   └── VT323
│   │       ├── OFL.txt
│   │       └── VT323-Regular.ttf
│   ├── images
│   │   ├── background.png
│   │   ├── heart.gif
│   │   ├── player.png
│   │   ├── smiley-green.png
│   │   └── smiley-yellow.png
│   ├── songs
│   │   ├── Around the Bend.ogg
│   │   └── In early time.ogg
│   └── sound
│       ├── collect.wav
│       └── life-lost.wav
├── button.rb
├── main.rb
├── player.rb
├── smiley.rb
├── song_player.rb
├── song.rb
├── ui.rb
├── window.rb
└── z_order.rb
</code></pre>

<p>Le code et les assets se trouvent <a href="https://github.com/lkdjiin/collect-the-smiles">sur Github</a>.
La version précise pour cet article est la <a href="https://github.com/lkdjiin/collect-the-smiles/releases/tag/v0.7.0">version 0.7.0</a>.</p>

<section><h1>Articles connexes</h1><ul><li><a href="/blog/2016/02/25/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-6/">Écrire un jeu en 2d avec Ruby et Gosu - partie 6</a></li><li><a href="/blog/2016/02/15/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-5/">Écrire un jeu en 2d avec Ruby et Gosu - partie 5</a></li><li><a href="/blog/2016/02/13/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-4/">Écrire un jeu en 2d avec Ruby et Gosu - partie 4</a></li></ul></section>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posté par <span class="fn">Xavier Nayrac</span></span>

      








  


<time datetime="2016-05-01T09:29:00+02:00" pubdate data-updated="true">1<span>er</span> mai 2016</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/2d/'>2d</a>, <a class='category' href='/blog/categories/gosu/'>gosu</a>, <a class='category' href='/blog/categories/jeu/'>jeu</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2016/02/25/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-6/" title="Previous Post: Écrire un jeu en 2d avec Ruby et Gosu - partie 6">&laquo; Écrire un jeu en 2d avec Ruby et Gosu - partie 6</a>
      
      
        <a class="basic-alignment right" href="/blog/2016/05/08/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-8/" title="Next Post: Écrire un jeu en 2d avec Ruby et Gosu - partie 8">Écrire un jeu en 2d avec Ruby et Gosu - partie 8 &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Commentaires</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Articles récents</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2019/11/10/le-format-eurorack/">Le format Eurorack</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/11/03/100-jours-de-synthe-modulaire/">100 jours de synthé modulaire</a>
      </li>
    
      <li class="post">
        <a href="/blog/2019/01/23/comparaison-de-deux-experiences-utilisateur/">Comparaison de deux expériences utilisateur</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/30/heroku-ovh-les-naked-domains-et-les-dns/">Heroku, OVH, les naked domains, et les DNS</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/08/21/comment-creer-votre-propre-localisation-sous-linux/">Comment créer votre propre localisation sous Linux</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/07/27/gopher-recuperer-le-menu-principal/">Gopher : Récupérer le menu principal</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/07/21/presentation-de-gopher/">Présentation de Gopher</a>
      </li>
    
      <li class="post">
        <a href="/blog/2018/02/14/lister-un-dossier-tout-en-nettoyant-lecran/">Lister un dossier tout en nettoyant l'écran</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/02/28/fish-completion-puis-execution-en-une-seule-fois/">Fish : complétion puis exécution en une seule fois</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/02/26/clojure-tests-et-couleurs/">Clojure, tests et couleurs</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/25/oui-la-documentation-est-utile/">Oui la documentation est utile</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/01/20/retour-sur-le-mooc-programmer-en-c/">Retour sur le MOOC Programmer en C</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/20/retour-du-mooc-designer-dans-un-fablab/">Retour du MOOC Designer dans un fablab</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/12/13/changer-de-shell-de-bash-a-fish/">Changer de shell, de Bash à Fish</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/11/bug-de-la-version-graphique-de-vim-sur-debian-sid/">Bug de la version graphique de Vim sur Debian Sid</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/11/02/comment-ecrire-un-framework-de-test-pour-ruby/">Comment écrire un framework de test pour Ruby</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/04/comment-mettre-a-jour-un-package-r/">Comment mettre à jour un package R</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/08/02/12-points-pour-rater-la-conception-dun-mooc/">12 points pour rater la conception d'un MOOC</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/08/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-8/">Écrire un jeu en 2d avec Ruby et Gosu - partie 8</a>
      </li>
    
      <li class="post">
        <a href="/blog/2016/05/01/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-7/">Écrire un jeu en 2d avec Ruby et Gosu - partie 7</a>
      </li>
    
  </ul>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2019 - Xavier Nayrac -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'confessionsdeveloppeur';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://lkdjiin.github.io/blog/2016/05/01/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-7/';
        var disqus_url = 'http://lkdjiin.github.io/blog/2016/05/01/ecrire-un-jeu-en-2d-avec-ruby-et-gosu-partie-7/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>


<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['\\(','\\)']]}
});
</script>
<script src='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>


</body>
</html>
